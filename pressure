import time
import serial
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import datetime

time.sleep(3)

sleeptime = 3600

ser = serial.Serial('/dev/tty.usbmodem1451', 9600)
#ttyACM0 on ubuntu

pressurelist = []
templist = []

timelist = [0]

#Time in minutes
#time_interval = 1800

print('Sampling time set to: ', sleeptime/60 , ' min')

while True:
    try:
        temp = []
        pres = []
        line = ser.readline()
        line = str(line)
        line = line.split(',')

        for char in line[0]:
            if char.isdigit() == True or char == '.':
                temp.append(char)
        temp = ''.join(temp)
        print(temp)
        temp = float(temp)

        for char in line[1]:
            if char.isdigit() == True or char == '.':
                pres.append(char)
        pres = ''.join(pres)
        print(pres)
        pres = float(pres)

        templist.append(temp)
        pressurelist.append(pres)


        # Make DataFrame
        filename = ('pressure_log', datetime.datetime.now().strftime("%Y%m%d"))
        filename = str(filename)

        data_list = [templist, pressurelist, timelist]
        data_list = {'Temp': templist, 'Pressure': pressurelist, 'Time': timelist}
        df = pd.DataFrame(data_list, columns=['Temp', 'Pressure', 'Time'])
        print(df)
        df.to_csv(filename, sep=' ')

        timelist.append(datetime.datetime.now().strftime('%H%M'))

        time.sleep(sleeptime)

    except KeyboardInterrupt:
        print('Exiting program..')
        exit()
        
